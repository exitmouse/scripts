This document is a how-to for installing a Fedora scripts.mit.edu server.

* Check out the scripts.mit.edu svn repository. Configure svn not to cache
  credentials.

* cd to server/fedora in the svn repository.

* Run "make install-deps" to install various prereqs.

* Create a scripts-build account, and set up rpm to build in $HOME.
  If you just use the default setup, it will generate packages
  in /usr/src/redhat.

* Use the Makefile to build the scripts.mit.edu-specific Fedora
  packages.
  - export PATH=$PATH:/usr/sbin
  - make download
  - make setup
  - make all
  - openafs-devel is a build-dependency of accountadm, so you'll need to
    install it by hand when that fails.
  Then install all the packages as root.

* Rebuild mit-zephyr on a 32-bit machine, like the one at Joe's home.

* Run "make suexec" and "make suexec-install" to overwrite
  /usr/sbin/suexec with one that works. The one installed by the
  newly-built Apache RPM is misconfigured.

* Check out the scripts /etc configuration, which is done most easily by
  - svn co https://scripts.mit.edu:1111/server/fedora/config/etc
  - \cp -a etc /

* Copy over root's dotfiles.

* Install various dependencies of the scripts system, including syslog-ng,
  glibc-devel.i386, python-twisted-core, mod_fcgid, nrpe, nagios-plugins-all.

* Disable SELinux and NetworkManager.

* Figure out why Zephyr isn't working and why the openafs /usr/vice/etc <->
  /etc/openafs mapping isn't in sync.

* Install the full list of RPMs that users expect to be on the
  scripts.mit.edu servers.  See server/doc/rpm and
  server/doc/rpm_snapshot.  (Note that this is only a snapshot, and not
  all packages may in fact be in use.)

* Install the full list of perl modules that users expect to be on the
  scripts.mit.edu servers.  See server/doc/perl and
  server/doc/perl_snapshot.

  - export PERL_MM_USE_DEFAULT=1
  - Run 'cpan', accept the default configuration, and do 'o conf
    prerequisites_policy follow'.
  - Parse the output of perldoc -u perllocal | grep head2 on an existing
    server, and "notest install" them from the cpan prompt.

* Install the Python eggs and Ruby gems and PEAR/PECL doohickeys that are on
  the other scripts.mit.edu servers and do not have RPMs.
  - Look at /usr/lib/python2.5/site-packages for Python eggs and modules.
  - Look at `gem list` for Ruby gems.
  - Look at `pear list` for Pear fruits (or whatever they're called).

* echo 'import site, os.path; site.addsitedir(os.path.expanduser("~/lib/python2.5/site-packages"))' > /usr/lib/python2.5/site-packages/00scripts-home.pth

* Install the credentials (machine keytab, daemon.scripts keytab, SSL
  certs).

* Attempt to check out server/fedora/config/etc into /etc. The easiest way to
  do this is to create a checkout of etc in another directory and mv -f this on
  top of /etc.

  - If you are setting up a test server, pay attention to
  /etc/sysconfig/network-scripts and do not bind scripts' IP address.
  You will also need to modify /etc/ldap.conf, /etc/openldap/ldap.conf, and
  /etc/httpd/conf.d/vhost_ldap.conf to use scripts.mit.edu instead of
  localhost.

* Install fedora-ds-base and set up replication (see /mit/scripts/doc
  and /mit/geofft/Public/fedora-ds-enable-ssl-and-kerberos.diff).

* Install nslcd / nss-ldapd, which, unlike nss-ldap, doesn't crash every few
  hours. Add /sbin/service dirsrv start and /sbin/nslcd to /etc/rc.local, or
  better yet package nss-ldapd properly.

* Make the services dirsrv, postfix, and httpd start at boot.

* Run fmtutil-sys --all, which does something that makes TeX work.

* (Optional) Beat your head against a wall.

* I recommend setting noatime for the root filesystem in /etc/fstab.

* Possibly perform other steps that I've neglected to put in this
  document.
