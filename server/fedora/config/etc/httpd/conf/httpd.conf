#ServerType standalone
ServerRoot /etc/httpd
#LockFile /var/lock/apache.lock
PidFile run/httpd.pid
#ScoreBoardFile /var/run/apache.scoreboard
Timeout 300
KeepAlive On
MaxKeepAliveRequests 1000
KeepAliveTimeout 5
MinSpareServers 5
MaxSpareServers 20
StartServers 8
MaxClients 256
MaxRequestsPerChild 4000

LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule auth_digest_module modules/mod_auth_digest.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_alias_module modules/mod_authn_alias.so
LoadModule authn_anon_module modules/mod_authn_anon.so
#LoadModule authn_dbm_module modules/mod_authn_dbm.so
LoadModule authn_default_module modules/mod_authn_default.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_owner_module modules/mod_authz_owner.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
#LoadModule authz_dbm_module modules/mod_authz_dbm.so
LoadModule authz_default_module modules/mod_authz_default.so
#LoadModule ldap_module modules/mod_ldap.so
#LoadModule authnz_ldap_module modules/mod_authnz_ldap.so
LoadModule include_module modules/mod_include.so
LoadModule log_config_module modules/mod_log_config.so
#LoadModule logio_module modules/mod_logio.so
LoadModule env_module modules/mod_env.so
LoadModule ext_filter_module modules/mod_ext_filter.so
#LoadModule mime_magic_module modules/mod_mime_magic.so
#LoadModule expires_module modules/mod_expires.so
#LoadModule deflate_module modules/mod_deflate.so
#LoadModule headers_module modules/mod_headers.so
#LoadModule usertrack_module modules/mod_usertrack.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule mime_module modules/mod_mime.so
#LoadModule dav_module modules/mod_dav.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so
#LoadModule info_module modules/mod_info.so
#LoadModule dav_fs_module modules/mod_dav_fs.so
#LoadModule vhost_alias_module modules/mod_vhost_alias.so
#LoadModule negotiation_module modules/mod_negotiation.so
LoadModule dir_module modules/mod_dir.so
LoadModule actions_module modules/mod_actions.so
#LoadModule speling_module modules/mod_speling.so
LoadModule userdir_module modules/mod_userdir.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so
#LoadModule proxy_module modules/mod_proxy.so
#LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
#LoadModule proxy_ftp_module modules/mod_proxy_ftp.so
#LoadModule proxy_http_module modules/mod_proxy_http.so
#LoadModule proxy_connect_module modules/mod_proxy_connect.so
#LoadModule cache_module modules/mod_cache.so
LoadModule suexec_module modules/mod_suexec.so
#LoadModule disk_cache_module modules/mod_disk_cache.so
#LoadModule file_cache_module modules/mod_file_cache.so
#LoadModule mem_cache_module modules/mod_mem_cache.so
LoadModule cgi_module modules/mod_cgi.so
LoadModule ssl_module modules/mod_ssl.so

User apache
Group apache

#ErrorDocument  403  /403-404.html
#ErrorDocument  404  /403-404.html
#ErrorDocument  500  /script_error.html

UserDir disabled

<Directory />
    AllowOverride All
    Options FollowSymLinks IncludesNoExec
</Directory>

<Directory /mit/*/web_scripts>
    AllowOverride All
    Options FollowSymLinks IncludesNoExec
</Directory>

<Directory /afs/athena.mit.edu/activity/*/*/web_scripts>
    AllowOverride All
    Options FollowSymLinks IncludesNoExec
</Directory>

<Directory /afs/athena.mit.edu/contrib/*/web_scripts>
    AllowOverride All
    Options FollowSymLinks IncludesNoExec
</Directory>

<Directory /afs/athena.mit.edu/course/*/*/web_scripts>
    AllowOverride All
    Options FollowSymLinks IncludesNoExec
</Directory>

<Directory /afs/athena.mit.edu/org/*/*/web_scripts>
    AllowOverride All
    Options FollowSymLinks IncludesNoExec
</Directory>

<Directory /afs/athena.mit.edu/user/*/*/*/web_scripts>
    AllowOverride All
    Options FollowSymLinks IncludesNoExec
</Directory>

<IfModule mod_dir.c>
    DirectoryIndex index.html index.htm index.cgi index.pl index.php index.py index.shtml
</IfModule>

AccessFileName .htaccess

<Files ~ "^\.ht">
	Order Allow,Deny
	Deny from all
</Files>

UseCanonicalName Off
TypesConfig /etc/mime.types
DefaultType text/plain
#MIMEMagicFile conf/magic

AddDefaultCharset on

HostnameLookups Off
ErrorLog "/home/logview/error_log"
LogLevel warn
LogFormat "%V %h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent
#CustomLog /var/log/httpd/access_log combined
ServerSignature Off
ServerAdmin scripts@mit.edu
ServerTokens Prod

Alias /icons /var/www/icons
<Directory /var/www/icons>
	Options None
	AllowOverride None
	<Files ~ "\.(gif|png)$">
		SetHandler default-handler
	</Files>
</Directory>

<IfModule mod_autoindex.c>
    IndexOptions FancyIndexing VersionSort NameWidth=* HTMLTable

    AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip

    AddIconByType (TXT,/icons/text.gif) text/*
    AddIconByType (IMG,/icons/image2.gif) image/*
    AddIconByType (SND,/icons/sound2.gif) audio/*
    AddIconByType (VID,/icons/movie.gif) video/*

    AddIcon /icons/binary.gif .bin .exe
    AddIcon /icons/binhex.gif .hqx
    AddIcon /icons/tar.gif .tar
    AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
    AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
    AddIcon /icons/a.gif .ps .ai .eps
    AddIcon /icons/layout.gif .html .shtml .htm .pdf
    AddIcon /icons/text.gif .txt
    AddIcon /icons/c.gif .c
    AddIcon /icons/p.gif .pl .py
    AddIcon /icons/f.gif .for
    AddIcon /icons/dvi.gif .dvi
    AddIcon /icons/uuencoded.gif .uu
    AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
    AddIcon /icons/tex.gif .tex
    AddIcon /icons/bomb.gif core
    AddIcon /icons/deb.gif .deb

    AddIcon /icons/back.gif ..
    AddIcon /icons/hand.right.gif README
    AddIcon /icons/folder.gif ^^DIRECTORY^^
    AddIcon /icons/blank.gif ^^BLANKICON^^

    DefaultIcon /icons/unknown.gif

    ReadmeName README
    HeaderName HEADER
    
    IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
</IfModule>

<IfModule mod_mime.c>
	AddType application/xhtml+xml         .xhtml
	AddType application/http-index-format .hti
	AddType text/html                     .html
	AddType text/css                      .css
	AddType text/xsl                      .xslt
	AddType application/x-javascript      .js
	AddType application/xml               .xml
	AddType image/svg+xml                 .svg
	AddType application/vnd.mozilla.xul+xml .xul
	AddType application/rdf+xml             .rdf
	AddType application/x-xpinstall         .xpi
	AddType text/xml .xsl
	#AddOutputFilterByType mod-xslt application/xml
	AddType text/html .shtml
	AddHandler server-parsed .shtml
</IfModule>

<IfModule mod_mime.c>
    AddEncoding x-compress Z
    AddEncoding x-gzip gz tgz

    AddLanguage da .dk
    AddLanguage nl .nl
    AddLanguage en .en
    AddLanguage et .ee
    AddLanguage fr .fr
    AddLanguage de .de
    AddLanguage el .el
    AddLanguage it .it
    AddLanguage ja .ja
    AddCharset ISO-2022-JP .jis
    AddLanguage pl .po
    AddCharset ISO-8859-2 .iso-pl
    AddLanguage pt .pt
    AddLanguage pt-br .pt-br
    AddLanguage ltz .lu
    AddLanguage ca .ca
    AddLanguage es .es
    AddLanguage sv .se
    AddLanguage cz .cz

    <IfModule mod_negotiation.c>
        LanguagePriority en da nl et fr de el it ja pl pt pt-br ltz ca es sv
    </IfModule>

    #AddType application/x-httpd-php .php
    #AddType application/x-httpd-php-source .phps

    AddType application/x-tar .tgz
    AddType image/bmp .bmp

    # hdml
    AddType text/x-hdml .hdml

    #AddType text/html .shtml
    #AddHandler server-parsed .shtml
</IfModule>

<IfModule mod_setenvif.c>
    BrowserMatch "Mozilla/2" nokeepalive
    BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
    BrowserMatch "RealPlayer 4\.0" force-response-1.0
    BrowserMatch "Java/1\.0" force-response-1.0
    BrowserMatch "JDK/1\.0" force-response-1.0
    SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown
</IfModule>

Listen 80

RLimitCPU 60 60
RLimitMEM 268435456 268435456 
RLimitNPROC 1024 1024

SetEnv REDIRECT_STATUS CGI
SetEnv PHPRC .

NameVirtualHost *:80
NameVirtualHost *:443
NameVirtualHost 18.181.0.50:80
NameVirtualHost 18.181.0.50:443

ServerName localhost
DocumentRoot /afs/athena.mit.edu/contrib/scripts/www

ExtendedStatus On
RewriteEngine Off

<Location ~ "/(robots\.txt|favicon\.ico)">
	RewriteEngine On
	RewriteBase /~scripts
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteRule .*(favicon\.ico) $1 [L,NS]
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteRule .*(robots\.txt) $1 [L,NS]
</Location>

Alias /heartbeat /afs/athena.mit.edu/contrib/scripts/web_scripts/heartbeat

<VirtualHost _default_:80>
	ServerName vhosts.mit.edu
	DocumentRoot /afs/athena.mit.edu/contrib/scripts/vhosts/server.php
	Include conf.d/vhosts-common.conf
</VirtualHost>

<VirtualHost 18.181.0.50:80>
	ServerName scripts-cert.mit.edu
	ServerAlias scripts-cert
	DocumentRoot /afs/athena.mit.edu/contrib/scripts/web_scripts/home
	SuExecUserGroup scripts users
	UserDir web_scripts
	RewriteEngine Off
	Include conf.d/vhosts-common.conf
</VirtualHost>

<VirtualHost *:80>
	ServerName scripts.mit.edu
	ServerAlias scripts scripts-test.mit.edu scripts-test 18.181.0.46 18.181.0.57 old-faithful.mit.edu old-faithful scripts3.mit.edu scripts3 18.181.0.53 better-mousetrap.mit.edu better-mousetrap scripts4.mit.edu scripts4
	DocumentRoot /afs/athena.mit.edu/contrib/scripts/web_scripts/home
	SuExecUserGroup scripts users
	UserDir web_scripts
	RewriteEngine Off
	Alias /src /afs/athena.mit.edu/contrib/scripts/src
	Redirect /sql https://scripts.mit.edu/~sql
	Include conf.d/vhosts-common.conf
</VirtualHost>

<IfModule ssl_module>
	Listen 443

	AddType application/x-x509-ca-cert .crt
	AddType application/x-pkcs7-crl    .crl

	SSLPassPhraseDialog  builtin
	SSLSessionCache dbm:/var/run/ssl_scache
	SSLSessionCacheTimeout 300
	SSLMutex file:/var/run/ssl_mutex
	SSLRandomSeed startup builtin
	SSLRandomSeed connect builtin
	SSLCertificateFile /etc/pki/tls/certs/cert-new.pem
	SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
	SSLCACertificateFile /etc/pki/tls/certs/ca.pem
	SSLVerifyClient none
	SSLOptions +StdEnvVars
	SSLUserName SSL_CLIENT_S_DN_Email
	<VirtualHost 18.181.0.50:443>
		ServerName scripts-cert.mit.edu
		ServerAlias scripts-cert
		DocumentRoot /afs/athena.mit.edu/contrib/scripts/web_scripts/home
		SuExecUserGroup scripts users
		UserDir web_scripts
		RewriteEngine Off
		Include conf.d/vhosts-common-ssl.conf
		SSLCertificateFile /etc/pki/tls/certs/scripts-cert-new.pem
		SSLVerifyClient require
		SSLVerifyDepth 1
	</VirtualHost>
	<VirtualHost *:443>
		ServerName vhosts.mit.edu
		ServerAlias vhosts
		DocumentRoot /afs/athena.mit.edu/contrib/scripts/vhosts/server.php
		RewriteEngine Off
		Include conf.d/vhosts-common-ssl.conf
	</VirtualHost>
	<VirtualHost *:443>
		ServerName scripts.mit.edu
		ServerAlias scripts scripts-test.mit.edu scripts-test
		DocumentRoot /afs/athena.mit.edu/contrib/scripts/web_scripts/home
		SuExecUserGroup scripts users
		UserDir web_scripts
		RewriteEngine Off
		Include conf.d/vhosts-common-ssl.conf
	</VirtualHost>
</IfModule>

Include vhosts.d/*.conf

LoadModule fcgid_module modules/mod_fcgid.so
AddHandler fcgid-script fcgi
<Files *.fcgi>
        Options +ExecCGI
</Files>
SocketPath run/mod_fcgid

Include conf.d/auth_sslcert.conf
Include conf.d/execsys.conf
